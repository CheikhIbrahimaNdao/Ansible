---
- name: Créer une base de données MySQL et un utilisateur
  hosts: votre_host_mysql
  become: yes
  vars_prompt:
    - name: mysql_root_password
      prompt: "Entrez le mot de passe root MySQL"
      private: yes
    - name: db_name
      prompt: "Nom de la base de données"
      private: no
    - name: db_user
      prompt: "Nom de l'utilisateur MySQL"
      private: no
    - name: db_user_password
      prompt: "Mot de passe de l'utilisateur MySQL"
      private: yes
  tasks:
    - name: Installer le client MySQL
      apt:
        name: mysql-client
        state: present
      when: ansible_os_family == 'Debian'

    - name: Installer le client MySQL
      yum:
        name: mysql
        state: present
      when: ansible_os_family == 'RedHat'

    - name: Créer une base de données
      mysql_db:
        name: "{{ db_name }}"
        state: present
      become_user: root
      become_method: sudo
      vars:
        mysql_root_password: "{{ mysql_root_password }}"

    - name: Créer un utilisateur MySQL avec tous les droits sur la base de données
      mysql_user:
        name: "{{ db_user }}"
        password: "{{ db_user_password }}"
        priv: "{{ db_name }}.*:ALL"
        state: present
      become_user: root
      become_method: sudo
      vars:
        mysql_root_password: "{{ mysql_root_password }}"
