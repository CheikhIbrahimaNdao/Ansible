---
- name: Retrieve MySQL user password
  hosts: localhost
  become: yes
  gather_facts: no
  vars_prompt:
    - name: mysql_root_password
      prompt: "Enter MySQL root password"
      private: yes
  tasks:
    - name: Check if user already exists
      shell: "mysql -uroot -p{{ mysql_root_password }} -e 'SELECT User FROM mysql.user WHERE User = \"User1\";'"
      register: user_check
      ignore_errors: yes

    - name: Get the password hash of the user if it exists
      shell: "mysql -uroot -p{{ mysql_root_password }} -e 'SELECT authentication_string FROM mysql.user WHERE User = \"User1\";'"
      register: password_hash
      when: user_check.stdout.find('User1') != -1
      ignore_errors: yes

    - name: Display user existence message
      debug:
        msg: "User1 exists"
      when: user_check.stdout.find('User1') != -1

    - name: Display password hash of the user
      debug:
        msg: "{{ password_hash.stdout }}"
      when: password_hash.stdout is defined

